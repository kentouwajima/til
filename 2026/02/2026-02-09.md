# Webアプリケーションの通信フローとDNS名前解決の仕組み

ユーザーがブラウザでURL（ドメイン名）を入力してから、実際のサーバーと通信が開始されるまでの全工程をまとめます。

## 1. 全体像

通信は大きく分けて **「DNS名前解決フェーズ」** と **「データ通信フェーズ」** の2段階で進行します。

---

## 2. DNS名前解決フェーズ（反復クエリ）

ブラウザがドメイン名（`example.com`）に対応するIPアドレスを特定するまでのプロセスです。

### 登場人物と役割

1. **DNSリゾルバー（キャッシュサーバー）**
* ユーザーの最も近い窓口。自分にキャッシュがない場合、世界中のサーバーへ「たらい回し」の旅に出る。


2. **ルートネームサーバー**
* DNSツリーの頂点。`.com` や `.jp` などのトップレベルドメイン（TLD）を管理するサーバーを案内する。


3. **TLDネームサーバー**
* 特定の拡張子（`.work` や `.com`）を管理。そのドメインを管理している「権威サーバー」を案内する。


4. **権威ネームサーバー（Authoritative Name Server）** ★AWS Route 53
* **最終目的地。** ドメイン所有者が設定した正確なIPアドレスを回答する。



### 解決までのステップ

1. ユーザーがURLを入力 → **DNSリゾルバー**へ問い合わせ。
2. リゾルバーが**ルートサーバー**へ：「`.com` はどこ？」 → 「TLDへ行け」
3. リゾルバーが**TLDサーバー**へ：「`example.com` はどこ？」 → 「Route 53へ行け」
4. リゾルバーが**権威サーバー（Route 53）**へ：「`example.com` のIPを教えて！」 → **「1.2.3.4 だよ」と回答**。
5. リゾルバーがブラウザに「1.2.3.4」を伝える。

---

## 3. データ通信フェーズ（TCP/HTTPS）

IPアドレスが判明した後、実際のデータ（HTML/JSONなど）を取得する工程です。

1. **TCP/TLSハンドシェイク**
* ブラウザが特定されたIP（ALBやCloudFront）に対して「これから通信していい？」と挨拶し、暗号化の鍵を交換する。


2. **HTTPリクエストの送信**
* `GET /index.html` などのリクエストを送信。


3. **ネットワークの旅（AWS内）**
* **CloudFront**: キャッシュがあれば即返却。なければオリジンへ。
* **ALB**: 負荷の低いEC2（ターゲット）へ振り分け。
* **EC2（Spring Boot）**: Javaプログラムが処理を実行し、RDS等からデータを取得。


4. **レスポンスの返却**
* サーバーが作成したデータをブラウザへ返送。



---

## 4. SAA試験・実務での重要ポイント

* **Alias（エイリアス）レコード**:
* Route 53独自の機能。ALBやCloudFrontへの名前解決には、CNAMEではなくAliasを使う（高速・無料・Zone Apex対応）。


* **TTL (Time To Live)**:
* 名前解決の結果を「どのくらいキャッシュしていいか」の時間。設定変更時はTTLが切れるまで古いIPに飛ぶ可能性がある。


* **ヘルスチェック**:
* 権威サーバー（Route 53）がサーバーの死活監視を行い、故障している場合は自動で予備のIPを回答する（フェイルオーバー）。



---

