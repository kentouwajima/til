# WordPress Migration Manual: Local to AWS (EC2/RDS/ALB)

このドキュメントは、ローカル環境のWordPressをTerraformで構築したAWS環境へ移行するための全手順をまとめたものです。

## 1. 事前準備 (ローカル)
1. WordPressディレクトリ一式をZIP圧縮する（例: `wordpress.zip`）
2. データベースをエクスポートする（例: `wordpress.sql`）

## 2. ファイル転送と展開
EC2の `/home/ec2-user` にファイルを転送後、以下のコマンドを実行します。

```bash
# ファイルの展開と配置
unzip wordpress.zip -d temp_wp
sudo cp -r temp_wp/* /var/www/html/
sudo chown -R apache:apache /var/www/html/

# 不要な一時ファイルの削除
rm -rf temp_wp wordpress.zip

## 3. データベースのセットアップ
RDSに接続し、移行用のデータベースを作成したあと、データをインポートします。
# RDSへの接続確認とDB作成
mysql -h [RDS_ENDPOINT] -u [USER] -p -e "CREATE DATABASE wordpress2;"

# SQL内のURL置換 (localhost:8888 を ALBのDNS名へ)
sed -i 's|http://localhost:8888|http://[ALB_DNS_NAME]|g' ~/wordpress.sql

# データのインポート
mysql -h [RDS_ENDPOINT] -u [USER] -p wordpress2 < ~/wordpress.sql

## 4. WordPress設定ファイルの編集
wp-config.php を開き、接続情報とURL強制上書き設定を追記します。
sudo vi /var/www/html/wp-config.php

修正・追記内容:
// データベース接続情報
define('DB_NAME', 'wordpress2');
define('DB_USER', '[RDS_USER]');
define('DB_PASSWORD', '[RDS_PASSWORD]');
define('DB_HOST', '[RDS_ENDPOINT]');

// URLの強制指定 (<?php の直下に追記)
define('WP_HOME', 'http://[ALB_DNS_NAME]');
define('WP_SITEURL', 'http://[ALB_DNS_NAME]');

## 5. WApacheの設定 (パーマリンク対応)
下層ページを表示可能にするため、.htaccess の読み込みを許可します。
sudo vi /etc/httpd/conf/httpd.conf

修正箇所: <Directory "/var/www/html"> セクション内の AllowOverride None を AllowOverride All に変更。
# 設定反映
sudo systemctl restart httpd


