# AWS SAA対策：ログ・監視サービスの完全攻略（CloudWatch vs CloudTrail vs Access Logs）

AWS初学者が最も混乱しやすい「ログ・監視サービス」の違いについて、実戦問題の解説を通してまとめました。

---

## 1. 例題：ALBのトラフィック解析

### シナリオ
会社はEC2インスタンスにALBを設定してマルチAZにクロスゾーン負荷分散を実施しているWEBアプリケーションを運用しています。
あなたはソリューションアーキテクトとして、このアプリケーションの解析を担当しています。**ALBによって処理されるすべてのHTTPリクエストに関する詳細情報を取得**して、トラフィック状況を解析することが求められています。

### この要件を満たすための対応は？

* [ ] CloudWatchでALBのメトリクスを取得する。
* [x] **ELBのアクセスログを有効にして、S3にログデータを保存する。**
* [ ] EC2の詳細モニタリングを有効にする。
* [ ] CloudTrailをELBに設定してアクセスログを取得する。

---

## 2. なぜ「ELBアクセスログ」が正解なのか？

問題文の要件は**「すべてのHTTPリクエストに関する詳細情報を取得」**することです。

「詳細情報」とは、以下のような**1件1件の通信の明細データ**を指します。
* **誰が来たか？**（送信元IPアドレス）
* **どこを見たか？**（リクエストパス、URL）
* **何を使ったか？**（ユーザーエージェント：スマホ/PC、ブラウザの種類）
* **どのくらい時間がかかったか？**（レイテンシー）

この**「通信の明細（ログ）」**を記録できるのは、**「アクセスログ」**だけです。
ELBのアクセスログは標準では**無効**になっているため、手動で有効化し、保存先としてS3バケットを指定する必要があります。

---

## 3. 3大監視サービスの違い（レストランの例え）

AWSには似たような監視サービスがありますが、役割が明確に違います。「レストラン」に例えると理解しやすくなります。

| サービス名 | 役割 | レストランでの例え | キーワード |
| :--- | :--- | :--- | :--- |
| **CloudWatch** | **健康診断・メーター** | 「今、お客さんは何人いる？」（数）<br>「キッチンの忙しさは何％？」（負荷）<br>「料理の提供が遅れていないか？」（アラート） | **パフォーマンス、CPU使用率、数値、アラート、メトリクス** |
| **CloudTrail** | **監視カメラ・犯人捜し** | 「**誰が**メニュー（設定）を書き換えた？」<br>「**誰が**店の鍵（SG）を開けた？」<br>「**誰が**サーバーを勝手に再起動した？」 | **API呼び出し、監査、誰が設定変更したか、セキュリティ調査** |
| **アクセスログ**<br>(S3保存) | **レシート・利用明細** | 「A席のお客さんはパスタを注文した」<br>「B席のお客さんはスマホからアクセスした」<br>「誰がどのページを見たか」 | **リクエストの詳細、IPアドレス、URL、足跡、通信ログ** |

---

## 4. 間違い選択肢の解説（なぜ違うのか？）

### × CloudWatchでALBのメトリクスを取得する
* **理由:** CloudWatchは**「統計データ（数字）」**を見るものです。「今、合計で100人来ている」とは分かりますが、「誰がどのページを見たか」という詳細までは分かりません。

### × EC2の詳細モニタリングを有効にする
* **理由:** これは**「EC2（サーバー）の負荷」**を1分単位で細かく見る機能です。ALBを通過する「ユーザーのリクエスト内容」とは関係ありません。

### × CloudTrailをELBに設定してアクセスログを取得する（最大のひっかけ）
* **理由:** CloudTrailは**「AWSに対する操作（APIコール）」**を記録するものです。「管理者がELBの設定を変更した」記録は取れますが、**「一般ユーザーがWebサイトを見た」というデータ通信の記録は取りません。**

---

## 5. 試験での「勝ちパターン」判断基準

問題文を読んだ瞬間、以下のキーワードに反応できるようにしましょう。

1.  **「パフォーマンス」「CPU使用率」「数値」「アラート」「異常検知」**
    * 👉 **CloudWatch** を選択。

2.  **「誰が設定変更したか」「API呼び出し」「監査」「コンプライアンス」「セキュリティインシデント調査」**
    * 👉 **CloudTrail** を選択。

3.  **「リクエストの詳細」「誰がどのページにアクセスしたか」「IPアドレス」「足跡」**
    * 👉 **アクセスログ (S3保存)** を選択。