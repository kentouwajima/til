# Terraform ディレクトリ構成の解説：なぜモジュール化するのか？

Terraformを学習し始めると、「ルートディレクトリに全てのファイルを並べる」構成と、「`modules` ディレクトリを作って分ける」構成の違いに戸惑うことがあります。

なぜ、あえてファイルをフォルダ（モジュール）ごとに分け、さらにその中で `main.tf`, `variables.tf`, `outputs.tf` に分割するのでしょうか？

その理由を、**「整理整頓」と「再利用」** の観点から解説します。

---

## 1. 例えで理解する：「ワンルーム」vs「間取りのある家」

インフラの規模が大きくなると、ファイルの管理方法は「部屋の片付け」と同じような課題に直面します。

### ❌ ルートに全て並べる構成（ワンルームの一人暮らし）
ひとつの大きな部屋に、ベッドもキッチンもトイレもシャワーも全て置いてある状態です。

* **メリット:** どこに何があるか、一目で見渡せます（コード量が少ないうちは楽）。
* **デメリット:** 物が増えてくると、「キッチンを掃除したいだけなのに、ベッドもどかさないといけない」といった不便さが生じます。どこからが寝室で、どこからが台所か分からなくなります。

### ✅ モジュール構成（間取りのある家）
「玄関」「キッチン」「リビング」「寝室」と部屋（フォルダ）が分かれている状態です。

* **メリット:** 「料理をするならキッチンへ」「寝るなら寝室へ」と役割がはっきりします。
* **デメリット:** 部屋を行き来（フォルダ移動）する手間が少し増えます。

---

## 2. モジュール化する3つのメリット

実務では、以下の理由からモジュール構成（フォルダ分け）が推奨されます。

### ① 「影響範囲」を限定できる（関心の分離）
もし1,000行ある1つの `main.tf` を修正する場合、どこか一箇所を書き間違えると、システム全体に影響が出るのではないかと不安になります。

モジュール化されていれば、「ネットワークの修正だから `modules/network/` だけ見ればいい」という風に、**頭を使う範囲を小さく絞る**ことができます。これをエンジニアリング用語で**「関心の分離」**と呼びます。

### ② コードを「部品」として再利用できる
例えば、今回作成した「VPCとサブネットを作るネットワーク構成」は、他のプロジェクトでもそのまま使える汎用的なものです。

* **ルート並列:** 他のプロジェクトにコピーするのが大変（「10行目〜50行目と、あと120行目が必要…」など切り出しが困難）。
* **モジュール:** `modules/network/` フォルダをそのままコピーするだけで、別の環境でも全く同じネットワークが作れます。

### ③ 「入り口」と「出口」がはっきりする
モジュール化することで、そのフォルダが「何を受け取って、何を返すのか」という**インターフェース**が明確になります。

---

## 3. なぜ `main` `variables` `outputs` に分けるのか？

一つのモジュール（ディレクトリ）の中で、さらに3つのファイルに分けるのは、**Terraform界の共通ルール（お作法）**です。これらは「関数の構造」に似ています。

| ファイル名 | 役割 | お料理での例え | プログラムでの例え |
| :--- | :--- | :--- | :--- |
| **`variables.tf`** | **入力（Inputs）** | 材料（卵、肉、野菜） | 引数 (Arguments) |
| **`main.tf`** | **処理（Resources）** | レシピ（焼く、煮る） | 関数本体 (Function Body) |
| **`outputs.tf`** | **出力（Outputs）** | できた料理（カレー） | 戻り値 (Return Values) |

### 具体的なメリット
* **`variables.tf` があるおかげで:**
    「この部品を使うには、何を渡せばいいのか（VPC IDが必要なのか、CIDRが必要なのか）」がひと目で分かります。
* **`outputs.tf` があるおかげで:**
    「この部品を作った結果、何が返ってくるのか（DBのエンドポイントが返ってくるのか、IPアドレスなのか）」がひと目で分かります。

これにより、中身の複雑なロジック（`main.tf`）を詳しく読まなくても、部品として使いこなせるようになります。

---

## 4. 構成図のイメージ

今回のプロジェクトの構成を整理すると、以下のようになります。

```text
.
├── main.tf            # 【総監督】各モジュールを呼び出して組み立てる
├── variables.tf       # プロジェクト全体の設定値
├── outputs.tf         # 最終的な成果物（WebサイトのURLなど）
│
└── modules/
    ├── network/       # 【ネットワーク部門】
    │   ├── main.tf        # VPCやサブネットを作る
    │   ├── variables.tf   # 「CIDRブロックは何にする？」等の要求
    │   └── outputs.tf     # 「作ったVPCのIDはこれです」等の報告
    │
    ├── compute/       # 【サーバー部門】
    │   ├── main.tf        # EC2を作る
    │   ├── variables.tf   # 「どのVPCに置く？鍵は何？」等の要求
    │   └── outputs.tf     # 「できたサーバーのIPはこれ」等の報告
    │
    └── ... (database, security, etc.)